<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
      <link rel="shortcut icon" href="../img/favicon.ico" />
    <title>Controlling the DER through VNC - CyberStrike Lab Workbook</title>
    <link rel="stylesheet" href="../css/theme.css" />
    <link rel="stylesheet" href="../css/theme_extra.css" />
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/styles/github.min.css" />
    
      <script>
        // Current page data
        var mkdocs_page_name = "Controlling the DER through VNC";
        var mkdocs_page_input_path = "lab-5\\control_der_vnc5.md";
        var mkdocs_page_url = null;
      </script>
    
    <!--[if lt IE 9]>
      <script src="../js/html5shiv.min.js"></script>
    <![endif]-->
      <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/highlight.min.js"></script>
      <script>hljs.highlightAll();</script> 
</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side stickynav">
    <div class="wy-side-scroll">
      <div class="wy-side-nav-search">
          <a href="../index.html" class="icon icon-home"> CyberStrike Lab Workbook
        </a>
      </div>

      <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../index.html">Home</a>
                </li>
              </ul>
              <p class="caption"><span class="caption-text">Overview</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../overview/labs_over.html">Laboratory Background Info</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">Lab 1 - Exploiting DER Interfaces</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../lab-2/over_lab2.html">Overview, Goals, Prerequisites</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" >Exercises</a>
    <ul>
                <li class="toctree-l2"><a class="reference internal" href="../lab-2/recon_nmap2.html">Reconnaissance with Nmap</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../lab-2/brute_force_ssh2.html">Brute Forcing SSH Passwords</a>
                </li>
    </ul>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">Lab 2 - DOS Attacks</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../lab-3/over_lab4.html">Overview, Goals, Prerequisites</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" >Exercises</a>
    <ul>
                <li class="toctree-l2"><a class="reference internal" href="../lab-3/dos.html">Denial of Service (DOS)</a>
                </li>
    </ul>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">Lab 3 - Firmware Analysis</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../lab-4/over_lab3b.html">Overview, Goals, and Prerequisites</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" >Exercises</a>
    <ul>
                <li class="toctree-l2"><a class="reference internal" href="../lab-4/der_firmware.html">Investigating DER Firmware</a>
                </li>
    </ul>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">Lab 4 - Firmware Cryptography</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../lab-4/over_lab3.html">Overview, Goals, and Prerequisites</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" >Exercises</a>
    <ul>
                <li class="toctree-l2"><a class="reference internal" href="../lab-4/malicious_update.html">Malicious Firmware</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../lab-4/encrypt_decrypt_data3.html">Encrypting/Decrypting Data (optional)</a>
                </li>
    </ul>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">Lab 5 - Web Exploitation</span></p>
              <ul class="current">
                  <li class="toctree-l1"><a class="reference internal" href="over_lab5.html">Overview, Goals, Prerequisites</a>
                  </li>
                  <li class="toctree-l1 current"><a class="reference internal current" >Exercises</a>
    <ul class="current">
                <li class="toctree-l2"><a class="reference internal" href="web_exploit.html">Website Exploits</a>
                </li>
                <li class="toctree-l2 current"><a class="reference internal current" href="#">Controlling the DER through VNC</a>
    <ul class="current">
    <li class="toctree-l3"><a class="reference internal" href="#password_cracking_with_john">Password Cracking with John</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#lab_5_lessons_learned">Lab 5 – Lessons Learned</a>
    </li>
    </ul>
                </li>
    </ul>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">Lab 6 - Vulnerable API and App Security</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../lab-6/over_lab6.html">Overview, Goals, Prerequisites</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" >Exercises</a>
    <ul>
                <li class="toctree-l2"><a class="reference internal" href="../lab-6/interacting_api.html">Vulnerable API</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../lab-6/app_inspect.html">Smart Phone App Inspection</a>
                </li>
    </ul>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">Lab 7 - Replay and MITM Attacks</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../lab-7/over_lab7.html">Overview, Goals, Prerequisites</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" >Exercises</a>
    <ul>
                <li class="toctree-l2"><a class="reference internal" href="../lab-7/replay-mitm.html">Replay and MITM</a>
                </li>
    </ul>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">Lab 8 - Security Improvements</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../lab-8/over_lab8.html">Overview, Goals, Prerequisites</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" >Exercises</a>
    <ul>
                <li class="toctree-l2"><a class="reference internal" href="../lab-8/20305firewalls.html">IEEE 2030.5 and FWs</a>
                </li>
    </ul>
                  </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../about.html">About</a>
                </li>
              </ul>
      </div>
    </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">
      <nav class="wy-nav-top" role="navigation" aria-label="Mobile navigation menu">
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">CyberStrike Lab Workbook</a>
        
      </nav>
      <div class="wy-nav-content">
        <div class="rst-content"><div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href="../index.html" class="icon icon-home" aria-label="Docs"></a></li>
          <li class="breadcrumb-item">Lab 5 - Web Exploitation</li>
          <li class="breadcrumb-item">Exercises</li>
      <li class="breadcrumb-item active">Controlling the DER through VNC</li>
    <li class="wy-breadcrumbs-aside">
    </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
            <div class="section" itemprop="articleBody">
              
                <h1 id="controlling_the_der_through_vnc">Controlling the DER through VNC<a class="headerlink" href="#controlling_the_der_through_vnc" title="Permanent link">&para;</a></h1>
<ol>
<li>
<p>Use the Kali icon to search for VNC Viewer and open the application.</p>
</li>
<li>
<p>To connect to the HMI, you will use the IP address you discovered via Nmap with the username and password combination for the system. </p>
<p>Enter <code>10.10.0.100:5900</code> in the VNC Server field at the top. You can also give this connection a name like <code>DER</code>. Click <strong>OK</strong>. And start the session by right clicking on the icon and selecting <strong>Connect</strong>. </p>
<p><img alt="SQL Injection via Browser" src="../img/vnc_setup.png" /></p>
</li>
<li>
<p>Enter the credentials that we learned from the website vulnerability.  Enter <code>vnc</code> as the user and <code>superman</code> as the password. </p>
<p><img alt="SQL Injection via Browser" src="../img/VNC_auth.PNG" />
NOTE: this VNC version requires a user of <code>vnc</code> to be entered. </p>
</li>
<li>
<p>Click on the image to enter the VNC session. This is an unencrypted way of interacting with systems.  </p>
<p>If prompted for a username/password, select <code>vnc</code> from the dropdown and enter <code>superman</code> as the password.</p>
<p><img alt="SQL Injection via Browser" src="../img/EnterVNC.PNG" /></p>
<p><strong>NOTE</strong>: Please restart the DER device if the VNC service is not working or is not letting you into the system. </p>
</li>
<li>
<p>Once you’re logged in you can see the operating system of the DER simulator.  Many DER devices don’t include GUIs, but this one does.  <strong>DON’T INTERACT WITH ANY OF THE RUNNING CODE PLEASE</strong>. Please open a new terminal by clicking on the 3x3 dot icon at the bottom and selecting <code>Terminal</code>.  </p>
</li>
<li>
<p>We can dump the hashed passwords of the der users from the <code>/etc/shadow</code> file using the following commands: </p>
<p><code>bash</code></p>
<p><code>sudo cat /etc/shadow | grep der</code></p>
<p>We see the following:
<code>deradmin:$6$VIAfkbqt58HrKuUp$knTnUiA4D1H.lNh2v0FnKdU32fRBtkcqXiMrw4lCAQmqgVgvznYFUhGJ.hjb4JZb.CTCGs98SVQMjjUMx5J8v1:19069:0:99999:7:::</code></p>
<p>The $6$ indicates that hash is SHA-512 with many rounds, the 2nd block of code <code>VIAfkbqt58HrKuUp</code> in this case is a base64-encoded salt that is added to the password before hashing to ensure the hash is unique.  The next chuck of code (<code>knTnUiA4D1H.lNh2v0FnKdU32fRBtkcqXiMrw4lCAQmqgVgvznYFUhGJ.hjb4JZb.CTCGs98SVQMjjUMx5J8v1</code>) is the hash of the password. </p>
<p><img alt="hash pass dump" src="../img/VNCPasswords.PNG" /></p>
</li>
<li>
<p>We’re interested in knowing the password for <strong>deradmin</strong> because it could be reused for cloud environments or other places.  We can crack this password using several tools including John the Ripper. </p>
</li>
<li>
<p>Close the VNC connection to the DER by exiting out of the VNC View Application. </p>
</li>
</ol>
<h2 id="password_cracking_with_john">Password Cracking with John<a class="headerlink" href="#password_cracking_with_john" title="Permanent link">&para;</a></h2>
<ol>
<li>
<p>John the Ripper is software used to crack password hashes. Take a look at all the options with the following <strong>Kali</strong> terminal command: </p>
<p><code>john --help</code></p>
</li>
<li>
<p>John requires hash files of a particular format, which can be generated using the following:</p>
<p><code>echo "deradmin:\$6\$VIAfkbqt58HrKuUp\$knTnUiA4D1H.lNh2v0FnKdU32fRBtkcqXiMrw4lCAQmqgVgvznYFUhGJ.hjb4JZb.CTCGs98SVQMjjUMx5J8v1" &gt; unshadowed.txt</code></p>
</li>
<li>
<p>Then the password can be determined with this dictionary search.</p>
<p><code>john --wordlist=/usr/share/wordlists/rockyou.txt unshadowed.txt</code></p>
<p>We can see that deradmin has the password <code>password1</code> and this could potentially be used to pivot to other portions of the network.  </p>
<p><img alt="" src="../img/cracked_pass.PNG" /></p>
<p>Note: if you would like to recrack the password, run <code>rm ~/.john/john.pot</code> to remove the cracked password file. </p>
</li>
</ol>
<h2 id="lab_5_lessons_learned">Lab 5 – Lessons Learned<a class="headerlink" href="#lab_5_lessons_learned" title="Permanent link">&para;</a></h2>
<p>This lab looked at exploiting different web interfaces and using information gained from remote access to further exploit the environment. We saw how SQL and code injection attacks can extract data from the server system.  We also saw how VNC connections to the equipment could be used to get additional sensitive information from the DER. These techniques are often used to elevate priviledges for the attacker.  Lastly, we saw how a password hash could be cracked to expose the user's plaintext password. </p>
              
            </div>
          </div><footer>
    <div class="rst-footer-buttons" role="navigation" aria-label="Footer Navigation">
        <a href="web_exploit.html" class="btn btn-neutral float-left" title="Website Exploits"><span class="icon icon-circle-arrow-left"></span> Previous</a>
        <a href="../lab-6/over_lab6.html" class="btn btn-neutral float-right" title="Overview, Goals, Prerequisites">Next <span class="icon icon-circle-arrow-right"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <!-- Copyright etc -->
      <p>2022 National Technology and Engineering Solutions of Sandia, LLC</p>
  </div>

  Built with <a href="https://www.mkdocs.org/">MkDocs</a> using a <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>.
</footer>
          
        </div>
      </div>

    </section>

  </div>

  <div class="rst-versions" role="note" aria-label="Versions">
  <span class="rst-current-version" data-toggle="rst-current-version">
    
    
      <span><a href="web_exploit.html" style="color: #fcfcfc">&laquo; Previous</a></span>
    
    
      <span><a href="../lab-6/over_lab6.html" style="color: #fcfcfc">Next &raquo;</a></span>
    
  </span>
</div>
    <script src="../js/jquery-3.6.0.min.js"></script>
    <script>var base_url = "..";</script>
    <script src="../js/theme_extra.js"></script>
    <script src="../js/theme.js"></script>
    <script>
        jQuery(function () {
            SphinxRtdTheme.Navigation.enable(true);
        });
    </script>

</body>
</html>
